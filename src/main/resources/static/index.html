<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>42Cabi - JWT Test</title>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 10px; }
        .box { border: 1px solid #ddd; padding: 20px; margin: 20px auto; max-width: 500px; border-radius: 10px; }
        #token-area { word-break: break-all; color: green; font-size: 12px; margin: 10px 0; }
        #result { margin-top: 20px; font-weight: bold; color: blue; white-space: pre-wrap; }
    </style>
</head>
<body>

<h1>ğŸ” JWT ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h1>

<div class="box">
    <h3>1. ì¸ì¦ ìƒíƒœ</h3>
    <div id="token-display">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>

    <a href="/oauth2/authorization/42">
        <button style="background-color: #00babc; color: white; border: none;">
            42 Login (í† í° ë°œê¸‰)
        </button>
    </a>
</div>

<div class="box">
    <h3>2. ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ (í† í° ìë™ í¬í•¨)</h3>
    <button onclick="requestApi('POST', '/v4/store/buy/1')">ğŸ›’ ì•„ì´í…œ êµ¬ë§¤</button>
    <button onclick="requestApi('POST', '/v4/lent/cabinets/1')">ğŸ”‘ ì‚¬ë¬¼í•¨ ëŒ€ì—¬</button>
    <button onclick="requestApi('POST', '/v4/lent/return')">â†©ï¸ ì‚¬ë¬¼í•¨ ë°˜ë‚©</button>
</div>

<div id="result">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

<script>
    let jwtToken = null;

    // 1. í˜ì´ì§€ ë¡œë“œ ì‹œ URLì—ì„œ í† í° ì°¾ê¸°
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');

        if (token) {
            jwtToken = token;
            document.getElementById('token-display').innerHTML =
                `âœ… <b>ì¸ì¦ë¨!</b><div id="token-area">${token.substring(0, 50)}...</div>`;

            // í† í°ì„ ì €ì¥í•´ë‘ê³  URLì€ ê¹”ë”í•˜ê²Œ ì •ë¦¬ (ì„ íƒì‚¬í•­)
            window.history.replaceState({}, document.title, "/");
        }
    };

    // 2. API ìš”ì²­ ë³´ë‚¼ ë•Œ í—¤ë”ì— í† í° ë„£ê¸°
    function requestApi(method, url) {
        if (!jwtToken) {
            alert("ë¨¼ì € ë¡œê·¸ì¸ì„ í•´ì„œ í† í°ì„ ë°œê¸‰ë°›ìœ¼ì„¸ìš”!");
            return;
        }

        fetch(url, {
            method: method,
            headers: {
                // ğŸ‘‡ ì—¬ê¸°ê°€ í•µì‹¬! Bearer í† í° ì¶”ê°€
                'Authorization': 'Bearer ' + jwtToken
            }
        })
            .then(response => response.json()) // JSON ì‘ë‹µìœ¼ë¡œ ë³€ê²½ë¨
            .then(data => {
                document.getElementById('result').innerText = JSON.stringify(data, null, 2);
            })
            .catch(err => {
                document.getElementById('result').innerText = "ì—ëŸ¬: " + err;
            });
    }
</script>
</body>
</html>